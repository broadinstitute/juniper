databaseChangeLog:
  - changeSet:
      id: "base_data_model"
      author: dbush
      changes:
        - createTable:
            tableName: portal
            columns:
              - column: &idColumn
                  { name: id, type: uuid, defaultValueComputed: gen_random_uuid(), constraints: { nullable: false, primaryKey: true } }
              - column: &createdAt
                  { name: created_at, type: datetime, constraints: { nullable: false } }
              - column: &lastUpdatedAt
                  { name: last_updated_at, type: datetime, constraints: { nullable: false } }
              - column: { name: name, type: text, constraints: { nullable: false } }
              - column: { name: shortcode, type: text, constraints: { nullable: false, unique: true } }
        - createTable:
            # base table for participant user login identities.
            # would be called 'user', but that's a reserved word in postgres
            tableName: participant_user
            columns:
              - column: *idColumn
              - column: *createdAt
              - column: *lastUpdatedAt
              - column: { name: username, type: text, constraints: { nullable: false }}
              - column: { name: superuser, type: boolean, defaultValueBoolean: false, constraints: { nullable: false }}
              - column: { name: token, type: text}
              - column: { name: last_login, type: datetime }
        - createTable:
            tableName: portal_participant_user
            columns:
              - column: *idColumn
              - column: *createdAt
              - column: *lastUpdatedAt
              - column: { name: user_id, type: uuid, constraints: {
                  nullable: false, foreignKeyName: fk_portal_user_participant_user, references: participant_user(id)
              } }
              - column: { name: portal_id, type: uuid, constraints: {
                nullable: false, foreignKeyName: fk_portal_user_portal, references: portal(id)
              } }
              - column: { name: lastLogin, type: datetime }
              - column: { name: withdrawn, type: boolean, defaultValueBoolean: false, constraints: { nullable: false } }


