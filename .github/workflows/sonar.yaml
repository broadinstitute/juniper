name: Sonar
on: workflow_dispatch

jobs:
  sonar-java:
    name: SonarCloud Java
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Scan via gradle
        run: >-
          ./gradlew 
          --build-cache 
          -x test 
          -x spotlessJava 
          -x spotlessJavaApply 
          -x spotlessJavaCheck 
          -x spotlessCheck 
          -x spotlessApply 
          build sonar -info
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # Needed to get PR information, if any
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
