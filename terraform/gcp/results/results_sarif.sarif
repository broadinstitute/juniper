{"$schema": "https://raw.githubusercontent.com/oasis-tcs/sarif-spec/master/Schemata/sarif-schema-2.1.0.json", "version": "2.1.0", "runs": [{"tool": {"driver": {"name": "Checkov", "version": "3.2.256", "informationUri": "https://checkov.io", "rules": [{"id": "CKV_GCP_61", "name": "Enable VPC Flow Logs and Intranode Visibility", "shortDescription": {"text": "Enable VPC Flow Logs and Intranode Visibility"}, "fullDescription": {"text": "Enable VPC Flow Logs and Intranode Visibility"}, "help": {"text": "Enable VPC Flow Logs and Intranode Visibility\nResource: google_container_cluster.juniper_cluster"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_GCP_70", "name": "Ensure the GKE Release Channel is set", "shortDescription": {"text": "Ensure the GKE Release Channel is set"}, "fullDescription": {"text": "Ensure the GKE Release Channel is set"}, "help": {"text": "Ensure the GKE Release Channel is set\nResource: google_container_cluster.juniper_cluster"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_GCP_21", "name": "Ensure Kubernetes Clusters are configured with Labels", "shortDescription": {"text": "Ensure Kubernetes Clusters are configured with Labels"}, "fullDescription": {"text": "Ensure Kubernetes Clusters are configured with Labels"}, "help": {"text": "Ensure Kubernetes Clusters are configured with Labels\nResource: google_container_cluster.juniper_cluster"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_GCP_13", "name": "Ensure client certificate authentication to Kubernetes Engine Clusters is disabled", "shortDescription": {"text": "Ensure client certificate authentication to Kubernetes Engine Clusters is disabled"}, "fullDescription": {"text": "Ensure client certificate authentication to Kubernetes Engine Clusters is disabled"}, "help": {"text": "Ensure client certificate authentication to Kubernetes Engine Clusters is disabled\nResource: google_container_cluster.juniper_cluster"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_GCP_65", "name": "Manage Kubernetes RBAC users with Google Groups for GKE", "shortDescription": {"text": "Manage Kubernetes RBAC users with Google Groups for GKE"}, "fullDescription": {"text": "Manage Kubernetes RBAC users with Google Groups for GKE"}, "help": {"text": "Manage Kubernetes RBAC users with Google Groups for GKE\nResource: google_container_cluster.juniper_cluster"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_GCP_69", "name": "Ensure the GKE Metadata Server is Enabled", "shortDescription": {"text": "Ensure the GKE Metadata Server is Enabled"}, "fullDescription": {"text": "Ensure the GKE Metadata Server is Enabled"}, "help": {"text": "Ensure the GKE Metadata Server is Enabled\nResource: google_container_cluster.juniper_cluster"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_GCP_12", "name": "Ensure Network Policy is enabled on Kubernetes Engine Clusters", "shortDescription": {"text": "Ensure Network Policy is enabled on Kubernetes Engine Clusters"}, "fullDescription": {"text": "Ensure Network Policy is enabled on Kubernetes Engine Clusters"}, "help": {"text": "Ensure Network Policy is enabled on Kubernetes Engine Clusters\nResource: google_container_cluster.juniper_cluster"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_GCP_43", "name": "Ensure KMS encryption keys are rotated within a period of 90 days", "shortDescription": {"text": "Ensure KMS encryption keys are rotated within a period of 90 days"}, "fullDescription": {"text": "Ensure KMS encryption keys are rotated within a period of 90 days"}, "help": {"text": "Ensure KMS encryption keys are rotated within a period of 90 days\nResource: google_kms_crypto_key.juniper_cluster_crypto_key"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_GCP_82", "name": "Ensure KMS keys are protected from deletion", "shortDescription": {"text": "Ensure KMS keys are protected from deletion"}, "fullDescription": {"text": "Ensure KMS keys are protected from deletion"}, "help": {"text": "Ensure KMS keys are protected from deletion\nResource: google_kms_crypto_key.juniper_cluster_crypto_key"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_GCP_52", "name": "Ensure PostgreSQL database 'log_connections' flag is set to 'on'", "shortDescription": {"text": "Ensure PostgreSQL database 'log_connections' flag is set to 'on'"}, "fullDescription": {"text": "Ensure PostgreSQL database 'log_connections' flag is set to 'on'"}, "help": {"text": "Ensure PostgreSQL database 'log_connections' flag is set to 'on'\nResource: google_sql_database_instance.d2p"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_GCP_108", "name": "Ensure hostnames are logged for GCP PostgreSQL databases", "shortDescription": {"text": "Ensure hostnames are logged for GCP PostgreSQL databases"}, "fullDescription": {"text": "Ensure hostnames are logged for GCP PostgreSQL databases"}, "help": {"text": "Ensure hostnames are logged for GCP PostgreSQL databases\nResource: google_sql_database_instance.d2p"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_GCP_6", "name": "Ensure all Cloud SQL database instance requires all incoming connections to use SSL", "shortDescription": {"text": "Ensure all Cloud SQL database instance requires all incoming connections to use SSL"}, "fullDescription": {"text": "Ensure all Cloud SQL database instance requires all incoming connections to use SSL"}, "help": {"text": "Ensure all Cloud SQL database instance requires all incoming connections to use SSL\nResource: google_sql_database_instance.d2p"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_GCP_110", "name": "Ensure pgAudit is enabled for your GCP PostgreSQL database", "shortDescription": {"text": "Ensure pgAudit is enabled for your GCP PostgreSQL database"}, "fullDescription": {"text": "Ensure pgAudit is enabled for your GCP PostgreSQL database"}, "help": {"text": "Ensure pgAudit is enabled for your GCP PostgreSQL database\nResource: google_sql_database_instance.d2p"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_GCP_51", "name": "Ensure PostgreSQL database 'log_checkpoints' flag is set to 'on'", "shortDescription": {"text": "Ensure PostgreSQL database 'log_checkpoints' flag is set to 'on'"}, "fullDescription": {"text": "Ensure PostgreSQL database 'log_checkpoints' flag is set to 'on'"}, "help": {"text": "Ensure PostgreSQL database 'log_checkpoints' flag is set to 'on'\nResource: google_sql_database_instance.d2p"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_GCP_53", "name": "Ensure PostgreSQL database 'log_disconnections' flag is set to 'on'", "shortDescription": {"text": "Ensure PostgreSQL database 'log_disconnections' flag is set to 'on'"}, "fullDescription": {"text": "Ensure PostgreSQL database 'log_disconnections' flag is set to 'on'"}, "help": {"text": "Ensure PostgreSQL database 'log_disconnections' flag is set to 'on'\nResource: google_sql_database_instance.d2p"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_GCP_109", "name": "Ensure the GCP PostgreSQL database log levels are set to ERROR or lower", "shortDescription": {"text": "Ensure the GCP PostgreSQL database log levels are set to ERROR or lower"}, "fullDescription": {"text": "Ensure the GCP PostgreSQL database log levels are set to ERROR or lower"}, "help": {"text": "Ensure the GCP PostgreSQL database log levels are set to ERROR or lower\nResource: google_sql_database_instance.d2p"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_GCP_111", "name": "Ensure GCP PostgreSQL logs SQL statements", "shortDescription": {"text": "Ensure GCP PostgreSQL logs SQL statements"}, "fullDescription": {"text": "Ensure GCP PostgreSQL logs SQL statements"}, "help": {"text": "Ensure GCP PostgreSQL logs SQL statements\nResource: google_sql_database_instance.d2p"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_GCP_54", "name": "Ensure PostgreSQL database 'log_lock_waits' flag is set to 'on'", "shortDescription": {"text": "Ensure PostgreSQL database 'log_lock_waits' flag is set to 'on'"}, "fullDescription": {"text": "Ensure PostgreSQL database 'log_lock_waits' flag is set to 'on'"}, "help": {"text": "Ensure PostgreSQL database 'log_lock_waits' flag is set to 'on'\nResource: google_sql_database_instance.d2p"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_TF_1", "name": "Ensure Terraform module sources use a commit hash", "shortDescription": {"text": "Ensure Terraform module sources use a commit hash"}, "fullDescription": {"text": "Ensure Terraform module sources use a commit hash"}, "help": {"text": "Ensure Terraform module sources use a commit hash\nResource: cloud-nat"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_GCP_76", "name": "Ensure that Private google access is enabled for IPV6", "shortDescription": {"text": "Ensure that Private google access is enabled for IPV6"}, "fullDescription": {"text": "Ensure that Private google access is enabled for IPV6"}, "help": {"text": "Ensure that Private google access is enabled for IPV6\nResource: google_compute_subnetwork.juniper_subnetwork"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV2_GCP_18", "name": "Ensure GCP network defines a firewall and does not use the default firewall", "shortDescription": {"text": "Ensure GCP network defines a firewall and does not use the default firewall"}, "fullDescription": {"text": "Ensure GCP network defines a firewall and does not use the default firewall"}, "help": {"text": "Ensure GCP network defines a firewall and does not use the default firewall\nResource: google_compute_network.juniper_network"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV2_GCP_13", "name": "Ensure PostgreSQL database flag 'log_duration' is set to 'on'", "shortDescription": {"text": "Ensure PostgreSQL database flag 'log_duration' is set to 'on'"}, "fullDescription": {"text": "Ensure PostgreSQL database flag 'log_duration' is set to 'on'"}, "help": {"text": "Ensure PostgreSQL database flag 'log_duration' is set to 'on'\nResource: google_sql_database_instance.d2p"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_K8S_21", "name": "The default namespace should not be used", "shortDescription": {"text": "The default namespace should not be used"}, "fullDescription": {"text": "The default namespace should not be used"}, "help": {"text": "The default namespace should not be used\nResource: Service.default.participant-service"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_K8S_37", "name": "Minimize the admission of containers with capabilities assigned", "shortDescription": {"text": "Minimize the admission of containers with capabilities assigned"}, "fullDescription": {"text": "Minimize the admission of containers with capabilities assigned"}, "help": {"text": "Minimize the admission of containers with capabilities assigned\nResource: Deployment.default.admin-deployment"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_K8S_31", "name": "Ensure that the seccomp profile is set to docker/default or runtime/default", "shortDescription": {"text": "Ensure that the seccomp profile is set to docker/default or runtime/default"}, "fullDescription": {"text": "Ensure that the seccomp profile is set to docker/default or runtime/default"}, "help": {"text": "Ensure that the seccomp profile is set to docker/default or runtime/default\nResource: Deployment.default.admin-deployment"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_K8S_8", "name": "Liveness Probe Should be Configured", "shortDescription": {"text": "Liveness Probe Should be Configured"}, "fullDescription": {"text": "Liveness Probe Should be Configured"}, "help": {"text": "Liveness Probe Should be Configured\nResource: Deployment.default.admin-deployment"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_K8S_20", "name": "Containers should not run with allowPrivilegeEscalation", "shortDescription": {"text": "Containers should not run with allowPrivilegeEscalation"}, "fullDescription": {"text": "Containers should not run with allowPrivilegeEscalation"}, "help": {"text": "Containers should not run with allowPrivilegeEscalation\nResource: Deployment.default.admin-deployment"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_K8S_15", "name": "Image Pull Policy should be Always", "shortDescription": {"text": "Image Pull Policy should be Always"}, "fullDescription": {"text": "Image Pull Policy should be Always"}, "help": {"text": "Image Pull Policy should be Always\nResource: Deployment.default.admin-deployment"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_K8S_13", "name": "Memory limits should be set", "shortDescription": {"text": "Memory limits should be set"}, "fullDescription": {"text": "Memory limits should be set"}, "help": {"text": "Memory limits should be set\nResource: Deployment.default.admin-deployment"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_K8S_40", "name": "Containers should run as a high UID to avoid host conflict", "shortDescription": {"text": "Containers should run as a high UID to avoid host conflict"}, "fullDescription": {"text": "Containers should run as a high UID to avoid host conflict"}, "help": {"text": "Containers should run as a high UID to avoid host conflict\nResource: Deployment.default.admin-deployment"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_K8S_22", "name": "Use read-only filesystem for containers where possible", "shortDescription": {"text": "Use read-only filesystem for containers where possible"}, "fullDescription": {"text": "Use read-only filesystem for containers where possible"}, "help": {"text": "Use read-only filesystem for containers where possible\nResource: Deployment.default.admin-deployment"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_K8S_9", "name": "Readiness Probe Should be Configured", "shortDescription": {"text": "Readiness Probe Should be Configured"}, "fullDescription": {"text": "Readiness Probe Should be Configured"}, "help": {"text": "Readiness Probe Should be Configured\nResource: Deployment.default.admin-deployment"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_K8S_28", "name": "Minimize the admission of containers with the NET_RAW capability", "shortDescription": {"text": "Minimize the admission of containers with the NET_RAW capability"}, "fullDescription": {"text": "Minimize the admission of containers with the NET_RAW capability"}, "help": {"text": "Minimize the admission of containers with the NET_RAW capability\nResource: Deployment.default.admin-deployment"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_K8S_29", "name": "Apply security context to your pods and containers", "shortDescription": {"text": "Apply security context to your pods and containers"}, "fullDescription": {"text": "Apply security context to your pods and containers"}, "help": {"text": "Apply security context to your pods and containers\nResource: Deployment.default.admin-deployment"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_K8S_30", "name": "Apply security context to your containers", "shortDescription": {"text": "Apply security context to your containers"}, "fullDescription": {"text": "Apply security context to your containers"}, "help": {"text": "Apply security context to your containers\nResource: Deployment.default.admin-deployment"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_K8S_38", "name": "Ensure that Service Account Tokens are only mounted where necessary", "shortDescription": {"text": "Ensure that Service Account Tokens are only mounted where necessary"}, "fullDescription": {"text": "Ensure that Service Account Tokens are only mounted where necessary"}, "help": {"text": "Ensure that Service Account Tokens are only mounted where necessary\nResource: Deployment.default.admin-deployment"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_K8S_23", "name": "Minimize the admission of root containers", "shortDescription": {"text": "Minimize the admission of root containers"}, "fullDescription": {"text": "Minimize the admission of root containers"}, "help": {"text": "Minimize the admission of root containers\nResource: Deployment.default.admin-deployment"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_K8S_43", "name": "Image should use digest", "shortDescription": {"text": "Image should use digest"}, "fullDescription": {"text": "Image should use digest"}, "help": {"text": "Image should use digest\nResource: Deployment.default.admin-deployment"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV_K8S_11", "name": "CPU limits should be set", "shortDescription": {"text": "CPU limits should be set"}, "fullDescription": {"text": "CPU limits should be set"}, "help": {"text": "CPU limits should be set\nResource: Deployment.default.admin-deployment"}, "defaultConfiguration": {"level": "error"}}, {"id": "CKV2_K8S_6", "name": "Minimize the admission of pods which lack an associated NetworkPolicy", "shortDescription": {"text": "Minimize the admission of pods which lack an associated NetworkPolicy"}, "fullDescription": {"text": "Minimize the admission of pods which lack an associated NetworkPolicy"}, "help": {"text": "Minimize the admission of pods which lack an associated NetworkPolicy\nResource: Pod.default.admin-deployment.app-admin"}, "defaultConfiguration": {"level": "error"}}], "organization": "bridgecrew"}}, "results": [{"ruleId": "CKV_GCP_61", "ruleIndex": 0, "level": "error", "attachments": [], "message": {"text": "Enable VPC Flow Logs and Intranode Visibility"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "cluster.tf"}, "region": {"startLine": 1, "endLine": 52, "snippet": {"text": "resource \"google_container_cluster\" \"juniper_cluster\" {\n  name = \"juniper-cluster\"\n\n  location                 = var.region\n  enable_autopilot         = true\n  enable_l4_ilb_subsetting = true\n\n  network    = google_compute_network.juniper_network.id\n  subnetwork = google_compute_subnetwork.juniper_subnetwork.id\n\n  binary_authorization {\n    evaluation_mode = \"PROJECT_SINGLETON_POLICY_ENFORCE\"\n  }\n\n  ip_allocation_policy {\n    stack_type                    = \"IPV4_IPV6\"\n  }\n\n  cluster_autoscaling {\n    auto_provisioning_defaults {\n      service_account = google_service_account.cluster_service_account.email\n    }\n  }\n\n  private_cluster_config {\n    enable_private_nodes    = true\n  }\n\n  master_authorized_networks_config {\n    dynamic \"cidr_blocks\" {\n      for_each = var.authorized_networks\n      content {\n        cidr_block   = cidr_blocks.value\n        display_name = cidr_blocks.value\n      }\n    }\n  }\n\n  database_encryption {\n    key_name = google_kms_crypto_key.juniper_cluster_crypto_key.id\n    state    = \"ENCRYPTED\"\n  }\n\n  # Set `deletion_protection` to `true` will ensure that one cannot\n  # accidentally delete this instance by use of Terraform.\n  deletion_protection = false\n\n  depends_on = [\n    time_sleep.enable_all_services_with_timeout,\n    google_kms_key_ring_iam_binding.cluster-key-ring\n  ]\n}\n"}}}}]}, {"ruleId": "CKV_GCP_70", "ruleIndex": 1, "level": "error", "attachments": [], "message": {"text": "Ensure the GKE Release Channel is set"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "cluster.tf"}, "region": {"startLine": 1, "endLine": 52, "snippet": {"text": "resource \"google_container_cluster\" \"juniper_cluster\" {\n  name = \"juniper-cluster\"\n\n  location                 = var.region\n  enable_autopilot         = true\n  enable_l4_ilb_subsetting = true\n\n  network    = google_compute_network.juniper_network.id\n  subnetwork = google_compute_subnetwork.juniper_subnetwork.id\n\n  binary_authorization {\n    evaluation_mode = \"PROJECT_SINGLETON_POLICY_ENFORCE\"\n  }\n\n  ip_allocation_policy {\n    stack_type                    = \"IPV4_IPV6\"\n  }\n\n  cluster_autoscaling {\n    auto_provisioning_defaults {\n      service_account = google_service_account.cluster_service_account.email\n    }\n  }\n\n  private_cluster_config {\n    enable_private_nodes    = true\n  }\n\n  master_authorized_networks_config {\n    dynamic \"cidr_blocks\" {\n      for_each = var.authorized_networks\n      content {\n        cidr_block   = cidr_blocks.value\n        display_name = cidr_blocks.value\n      }\n    }\n  }\n\n  database_encryption {\n    key_name = google_kms_crypto_key.juniper_cluster_crypto_key.id\n    state    = \"ENCRYPTED\"\n  }\n\n  # Set `deletion_protection` to `true` will ensure that one cannot\n  # accidentally delete this instance by use of Terraform.\n  deletion_protection = false\n\n  depends_on = [\n    time_sleep.enable_all_services_with_timeout,\n    google_kms_key_ring_iam_binding.cluster-key-ring\n  ]\n}\n"}}}}]}, {"ruleId": "CKV_GCP_21", "ruleIndex": 2, "level": "error", "attachments": [], "message": {"text": "Ensure Kubernetes Clusters are configured with Labels"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "cluster.tf"}, "region": {"startLine": 1, "endLine": 52, "snippet": {"text": "resource \"google_container_cluster\" \"juniper_cluster\" {\n  name = \"juniper-cluster\"\n\n  location                 = var.region\n  enable_autopilot         = true\n  enable_l4_ilb_subsetting = true\n\n  network    = google_compute_network.juniper_network.id\n  subnetwork = google_compute_subnetwork.juniper_subnetwork.id\n\n  binary_authorization {\n    evaluation_mode = \"PROJECT_SINGLETON_POLICY_ENFORCE\"\n  }\n\n  ip_allocation_policy {\n    stack_type                    = \"IPV4_IPV6\"\n  }\n\n  cluster_autoscaling {\n    auto_provisioning_defaults {\n      service_account = google_service_account.cluster_service_account.email\n    }\n  }\n\n  private_cluster_config {\n    enable_private_nodes    = true\n  }\n\n  master_authorized_networks_config {\n    dynamic \"cidr_blocks\" {\n      for_each = var.authorized_networks\n      content {\n        cidr_block   = cidr_blocks.value\n        display_name = cidr_blocks.value\n      }\n    }\n  }\n\n  database_encryption {\n    key_name = google_kms_crypto_key.juniper_cluster_crypto_key.id\n    state    = \"ENCRYPTED\"\n  }\n\n  # Set `deletion_protection` to `true` will ensure that one cannot\n  # accidentally delete this instance by use of Terraform.\n  deletion_protection = false\n\n  depends_on = [\n    time_sleep.enable_all_services_with_timeout,\n    google_kms_key_ring_iam_binding.cluster-key-ring\n  ]\n}\n"}}}}]}, {"ruleId": "CKV_GCP_13", "ruleIndex": 3, "level": "error", "attachments": [], "message": {"text": "Ensure client certificate authentication to Kubernetes Engine Clusters is disabled"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "cluster.tf"}, "region": {"startLine": 1, "endLine": 52, "snippet": {"text": "resource \"google_container_cluster\" \"juniper_cluster\" {\n  name = \"juniper-cluster\"\n\n  location                 = var.region\n  enable_autopilot         = true\n  enable_l4_ilb_subsetting = true\n\n  network    = google_compute_network.juniper_network.id\n  subnetwork = google_compute_subnetwork.juniper_subnetwork.id\n\n  binary_authorization {\n    evaluation_mode = \"PROJECT_SINGLETON_POLICY_ENFORCE\"\n  }\n\n  ip_allocation_policy {\n    stack_type                    = \"IPV4_IPV6\"\n  }\n\n  cluster_autoscaling {\n    auto_provisioning_defaults {\n      service_account = google_service_account.cluster_service_account.email\n    }\n  }\n\n  private_cluster_config {\n    enable_private_nodes    = true\n  }\n\n  master_authorized_networks_config {\n    dynamic \"cidr_blocks\" {\n      for_each = var.authorized_networks\n      content {\n        cidr_block   = cidr_blocks.value\n        display_name = cidr_blocks.value\n      }\n    }\n  }\n\n  database_encryption {\n    key_name = google_kms_crypto_key.juniper_cluster_crypto_key.id\n    state    = \"ENCRYPTED\"\n  }\n\n  # Set `deletion_protection` to `true` will ensure that one cannot\n  # accidentally delete this instance by use of Terraform.\n  deletion_protection = false\n\n  depends_on = [\n    time_sleep.enable_all_services_with_timeout,\n    google_kms_key_ring_iam_binding.cluster-key-ring\n  ]\n}\n"}}}}]}, {"ruleId": "CKV_GCP_65", "ruleIndex": 4, "level": "error", "attachments": [], "message": {"text": "Manage Kubernetes RBAC users with Google Groups for GKE"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "cluster.tf"}, "region": {"startLine": 1, "endLine": 52, "snippet": {"text": "resource \"google_container_cluster\" \"juniper_cluster\" {\n  name = \"juniper-cluster\"\n\n  location                 = var.region\n  enable_autopilot         = true\n  enable_l4_ilb_subsetting = true\n\n  network    = google_compute_network.juniper_network.id\n  subnetwork = google_compute_subnetwork.juniper_subnetwork.id\n\n  binary_authorization {\n    evaluation_mode = \"PROJECT_SINGLETON_POLICY_ENFORCE\"\n  }\n\n  ip_allocation_policy {\n    stack_type                    = \"IPV4_IPV6\"\n  }\n\n  cluster_autoscaling {\n    auto_provisioning_defaults {\n      service_account = google_service_account.cluster_service_account.email\n    }\n  }\n\n  private_cluster_config {\n    enable_private_nodes    = true\n  }\n\n  master_authorized_networks_config {\n    dynamic \"cidr_blocks\" {\n      for_each = var.authorized_networks\n      content {\n        cidr_block   = cidr_blocks.value\n        display_name = cidr_blocks.value\n      }\n    }\n  }\n\n  database_encryption {\n    key_name = google_kms_crypto_key.juniper_cluster_crypto_key.id\n    state    = \"ENCRYPTED\"\n  }\n\n  # Set `deletion_protection` to `true` will ensure that one cannot\n  # accidentally delete this instance by use of Terraform.\n  deletion_protection = false\n\n  depends_on = [\n    time_sleep.enable_all_services_with_timeout,\n    google_kms_key_ring_iam_binding.cluster-key-ring\n  ]\n}\n"}}}}]}, {"ruleId": "CKV_GCP_69", "ruleIndex": 5, "level": "error", "attachments": [], "message": {"text": "Ensure the GKE Metadata Server is Enabled"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "cluster.tf"}, "region": {"startLine": 1, "endLine": 52, "snippet": {"text": "resource \"google_container_cluster\" \"juniper_cluster\" {\n  name = \"juniper-cluster\"\n\n  location                 = var.region\n  enable_autopilot         = true\n  enable_l4_ilb_subsetting = true\n\n  network    = google_compute_network.juniper_network.id\n  subnetwork = google_compute_subnetwork.juniper_subnetwork.id\n\n  binary_authorization {\n    evaluation_mode = \"PROJECT_SINGLETON_POLICY_ENFORCE\"\n  }\n\n  ip_allocation_policy {\n    stack_type                    = \"IPV4_IPV6\"\n  }\n\n  cluster_autoscaling {\n    auto_provisioning_defaults {\n      service_account = google_service_account.cluster_service_account.email\n    }\n  }\n\n  private_cluster_config {\n    enable_private_nodes    = true\n  }\n\n  master_authorized_networks_config {\n    dynamic \"cidr_blocks\" {\n      for_each = var.authorized_networks\n      content {\n        cidr_block   = cidr_blocks.value\n        display_name = cidr_blocks.value\n      }\n    }\n  }\n\n  database_encryption {\n    key_name = google_kms_crypto_key.juniper_cluster_crypto_key.id\n    state    = \"ENCRYPTED\"\n  }\n\n  # Set `deletion_protection` to `true` will ensure that one cannot\n  # accidentally delete this instance by use of Terraform.\n  deletion_protection = false\n\n  depends_on = [\n    time_sleep.enable_all_services_with_timeout,\n    google_kms_key_ring_iam_binding.cluster-key-ring\n  ]\n}\n"}}}}]}, {"ruleId": "CKV_GCP_12", "ruleIndex": 6, "level": "error", "attachments": [], "message": {"text": "Ensure Network Policy is enabled on Kubernetes Engine Clusters"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "cluster.tf"}, "region": {"startLine": 1, "endLine": 52, "snippet": {"text": "resource \"google_container_cluster\" \"juniper_cluster\" {\n  name = \"juniper-cluster\"\n\n  location                 = var.region\n  enable_autopilot         = true\n  enable_l4_ilb_subsetting = true\n\n  network    = google_compute_network.juniper_network.id\n  subnetwork = google_compute_subnetwork.juniper_subnetwork.id\n\n  binary_authorization {\n    evaluation_mode = \"PROJECT_SINGLETON_POLICY_ENFORCE\"\n  }\n\n  ip_allocation_policy {\n    stack_type                    = \"IPV4_IPV6\"\n  }\n\n  cluster_autoscaling {\n    auto_provisioning_defaults {\n      service_account = google_service_account.cluster_service_account.email\n    }\n  }\n\n  private_cluster_config {\n    enable_private_nodes    = true\n  }\n\n  master_authorized_networks_config {\n    dynamic \"cidr_blocks\" {\n      for_each = var.authorized_networks\n      content {\n        cidr_block   = cidr_blocks.value\n        display_name = cidr_blocks.value\n      }\n    }\n  }\n\n  database_encryption {\n    key_name = google_kms_crypto_key.juniper_cluster_crypto_key.id\n    state    = \"ENCRYPTED\"\n  }\n\n  # Set `deletion_protection` to `true` will ensure that one cannot\n  # accidentally delete this instance by use of Terraform.\n  deletion_protection = false\n\n  depends_on = [\n    time_sleep.enable_all_services_with_timeout,\n    google_kms_key_ring_iam_binding.cluster-key-ring\n  ]\n}\n"}}}}]}, {"ruleId": "CKV_GCP_43", "ruleIndex": 7, "level": "error", "attachments": [], "message": {"text": "Ensure KMS encryption keys are rotated within a period of 90 days"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "cluster_kms_encryption.tf"}, "region": {"startLine": 10, "endLine": 13, "snippet": {"text": "resource \"google_kms_crypto_key\" \"juniper_cluster_crypto_key\" {\n  key_ring = google_kms_key_ring.juniper_cluster_keyring.id\n  name     = \"juniper-cluster-crypto-key\"\n}\n"}}}}]}, {"ruleId": "CKV_GCP_82", "ruleIndex": 8, "level": "error", "attachments": [], "message": {"text": "Ensure KMS keys are protected from deletion"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "cluster_kms_encryption.tf"}, "region": {"startLine": 10, "endLine": 13, "snippet": {"text": "resource \"google_kms_crypto_key\" \"juniper_cluster_crypto_key\" {\n  key_ring = google_kms_key_ring.juniper_cluster_keyring.id\n  name     = \"juniper-cluster-crypto-key\"\n}\n"}}}}]}, {"ruleId": "CKV_GCP_52", "ruleIndex": 9, "level": "error", "attachments": [], "message": {"text": "Ensure PostgreSQL database 'log_connections' flag is set to 'on'"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "db.tf"}, "region": {"startLine": 2, "endLine": 30, "snippet": {"text": "resource \"google_sql_database_instance\" \"d2p\" {\n  name = \"d2p\"\n  database_version = \"POSTGRES_16\"\n  region           = var.region\n  deletion_protection = false\n  settings {\n    tier = var.db_tier\n    ip_configuration {\n      ipv4_enabled    = false\n      private_network = google_compute_network.juniper_network.self_link\n      enable_private_path_for_google_cloud_services = true\n    }\n\n    database_flags {\n      name  = \"cloudsql.iam_authentication\"\n      value = \"on\"\n    }\n\n    backup_configuration {\n      enabled = true\n      start_time = \"04:00\"\n    }\n  }\n\n  depends_on = [\n    time_sleep.enable_all_services_with_timeout,\n    google_service_networking_connection.private_vpc_connection\n  ]\n}\n"}}}}]}, {"ruleId": "CKV_GCP_108", "ruleIndex": 10, "level": "error", "attachments": [], "message": {"text": "Ensure hostnames are logged for GCP PostgreSQL databases"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "db.tf"}, "region": {"startLine": 2, "endLine": 30, "snippet": {"text": "resource \"google_sql_database_instance\" \"d2p\" {\n  name = \"d2p\"\n  database_version = \"POSTGRES_16\"\n  region           = var.region\n  deletion_protection = false\n  settings {\n    tier = var.db_tier\n    ip_configuration {\n      ipv4_enabled    = false\n      private_network = google_compute_network.juniper_network.self_link\n      enable_private_path_for_google_cloud_services = true\n    }\n\n    database_flags {\n      name  = \"cloudsql.iam_authentication\"\n      value = \"on\"\n    }\n\n    backup_configuration {\n      enabled = true\n      start_time = \"04:00\"\n    }\n  }\n\n  depends_on = [\n    time_sleep.enable_all_services_with_timeout,\n    google_service_networking_connection.private_vpc_connection\n  ]\n}\n"}}}}]}, {"ruleId": "CKV_GCP_6", "ruleIndex": 11, "level": "error", "attachments": [], "message": {"text": "Ensure all Cloud SQL database instance requires all incoming connections to use SSL"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "db.tf"}, "region": {"startLine": 2, "endLine": 30, "snippet": {"text": "resource \"google_sql_database_instance\" \"d2p\" {\n  name = \"d2p\"\n  database_version = \"POSTGRES_16\"\n  region           = var.region\n  deletion_protection = false\n  settings {\n    tier = var.db_tier\n    ip_configuration {\n      ipv4_enabled    = false\n      private_network = google_compute_network.juniper_network.self_link\n      enable_private_path_for_google_cloud_services = true\n    }\n\n    database_flags {\n      name  = \"cloudsql.iam_authentication\"\n      value = \"on\"\n    }\n\n    backup_configuration {\n      enabled = true\n      start_time = \"04:00\"\n    }\n  }\n\n  depends_on = [\n    time_sleep.enable_all_services_with_timeout,\n    google_service_networking_connection.private_vpc_connection\n  ]\n}\n"}}}}]}, {"ruleId": "CKV_GCP_110", "ruleIndex": 12, "level": "error", "attachments": [], "message": {"text": "Ensure pgAudit is enabled for your GCP PostgreSQL database"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "db.tf"}, "region": {"startLine": 2, "endLine": 30, "snippet": {"text": "resource \"google_sql_database_instance\" \"d2p\" {\n  name = \"d2p\"\n  database_version = \"POSTGRES_16\"\n  region           = var.region\n  deletion_protection = false\n  settings {\n    tier = var.db_tier\n    ip_configuration {\n      ipv4_enabled    = false\n      private_network = google_compute_network.juniper_network.self_link\n      enable_private_path_for_google_cloud_services = true\n    }\n\n    database_flags {\n      name  = \"cloudsql.iam_authentication\"\n      value = \"on\"\n    }\n\n    backup_configuration {\n      enabled = true\n      start_time = \"04:00\"\n    }\n  }\n\n  depends_on = [\n    time_sleep.enable_all_services_with_timeout,\n    google_service_networking_connection.private_vpc_connection\n  ]\n}\n"}}}}]}, {"ruleId": "CKV_GCP_51", "ruleIndex": 13, "level": "error", "attachments": [], "message": {"text": "Ensure PostgreSQL database 'log_checkpoints' flag is set to 'on'"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "db.tf"}, "region": {"startLine": 2, "endLine": 30, "snippet": {"text": "resource \"google_sql_database_instance\" \"d2p\" {\n  name = \"d2p\"\n  database_version = \"POSTGRES_16\"\n  region           = var.region\n  deletion_protection = false\n  settings {\n    tier = var.db_tier\n    ip_configuration {\n      ipv4_enabled    = false\n      private_network = google_compute_network.juniper_network.self_link\n      enable_private_path_for_google_cloud_services = true\n    }\n\n    database_flags {\n      name  = \"cloudsql.iam_authentication\"\n      value = \"on\"\n    }\n\n    backup_configuration {\n      enabled = true\n      start_time = \"04:00\"\n    }\n  }\n\n  depends_on = [\n    time_sleep.enable_all_services_with_timeout,\n    google_service_networking_connection.private_vpc_connection\n  ]\n}\n"}}}}]}, {"ruleId": "CKV_GCP_53", "ruleIndex": 14, "level": "error", "attachments": [], "message": {"text": "Ensure PostgreSQL database 'log_disconnections' flag is set to 'on'"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "db.tf"}, "region": {"startLine": 2, "endLine": 30, "snippet": {"text": "resource \"google_sql_database_instance\" \"d2p\" {\n  name = \"d2p\"\n  database_version = \"POSTGRES_16\"\n  region           = var.region\n  deletion_protection = false\n  settings {\n    tier = var.db_tier\n    ip_configuration {\n      ipv4_enabled    = false\n      private_network = google_compute_network.juniper_network.self_link\n      enable_private_path_for_google_cloud_services = true\n    }\n\n    database_flags {\n      name  = \"cloudsql.iam_authentication\"\n      value = \"on\"\n    }\n\n    backup_configuration {\n      enabled = true\n      start_time = \"04:00\"\n    }\n  }\n\n  depends_on = [\n    time_sleep.enable_all_services_with_timeout,\n    google_service_networking_connection.private_vpc_connection\n  ]\n}\n"}}}}]}, {"ruleId": "CKV_GCP_109", "ruleIndex": 15, "level": "error", "attachments": [], "message": {"text": "Ensure the GCP PostgreSQL database log levels are set to ERROR or lower"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "db.tf"}, "region": {"startLine": 2, "endLine": 30, "snippet": {"text": "resource \"google_sql_database_instance\" \"d2p\" {\n  name = \"d2p\"\n  database_version = \"POSTGRES_16\"\n  region           = var.region\n  deletion_protection = false\n  settings {\n    tier = var.db_tier\n    ip_configuration {\n      ipv4_enabled    = false\n      private_network = google_compute_network.juniper_network.self_link\n      enable_private_path_for_google_cloud_services = true\n    }\n\n    database_flags {\n      name  = \"cloudsql.iam_authentication\"\n      value = \"on\"\n    }\n\n    backup_configuration {\n      enabled = true\n      start_time = \"04:00\"\n    }\n  }\n\n  depends_on = [\n    time_sleep.enable_all_services_with_timeout,\n    google_service_networking_connection.private_vpc_connection\n  ]\n}\n"}}}}]}, {"ruleId": "CKV_GCP_111", "ruleIndex": 16, "level": "error", "attachments": [], "message": {"text": "Ensure GCP PostgreSQL logs SQL statements"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "db.tf"}, "region": {"startLine": 2, "endLine": 30, "snippet": {"text": "resource \"google_sql_database_instance\" \"d2p\" {\n  name = \"d2p\"\n  database_version = \"POSTGRES_16\"\n  region           = var.region\n  deletion_protection = false\n  settings {\n    tier = var.db_tier\n    ip_configuration {\n      ipv4_enabled    = false\n      private_network = google_compute_network.juniper_network.self_link\n      enable_private_path_for_google_cloud_services = true\n    }\n\n    database_flags {\n      name  = \"cloudsql.iam_authentication\"\n      value = \"on\"\n    }\n\n    backup_configuration {\n      enabled = true\n      start_time = \"04:00\"\n    }\n  }\n\n  depends_on = [\n    time_sleep.enable_all_services_with_timeout,\n    google_service_networking_connection.private_vpc_connection\n  ]\n}\n"}}}}]}, {"ruleId": "CKV_GCP_54", "ruleIndex": 17, "level": "error", "attachments": [], "message": {"text": "Ensure PostgreSQL database 'log_lock_waits' flag is set to 'on'"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "db.tf"}, "region": {"startLine": 2, "endLine": 30, "snippet": {"text": "resource \"google_sql_database_instance\" \"d2p\" {\n  name = \"d2p\"\n  database_version = \"POSTGRES_16\"\n  region           = var.region\n  deletion_protection = false\n  settings {\n    tier = var.db_tier\n    ip_configuration {\n      ipv4_enabled    = false\n      private_network = google_compute_network.juniper_network.self_link\n      enable_private_path_for_google_cloud_services = true\n    }\n\n    database_flags {\n      name  = \"cloudsql.iam_authentication\"\n      value = \"on\"\n    }\n\n    backup_configuration {\n      enabled = true\n      start_time = \"04:00\"\n    }\n  }\n\n  depends_on = [\n    time_sleep.enable_all_services_with_timeout,\n    google_service_networking_connection.private_vpc_connection\n  ]\n}\n"}}}}]}, {"ruleId": "CKV_TF_1", "ruleIndex": 18, "level": "error", "attachments": [], "message": {"text": "Ensure Terraform module sources use a commit hash"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "network.tf"}, "region": {"startLine": 61, "endLine": 69, "snippet": {"text": "module \"cloud-nat\" {\n  source                             = \"terraform-google-modules/cloud-nat/google\"\n  version                            = \"~> 5.0\"\n  project_id                         = var.project\n  region                             = var.region\n  router                             = google_compute_router.juniper-router.name\n  name                               = \"juniper-nat-config\"\n  source_subnetwork_ip_ranges_to_nat = \"ALL_SUBNETWORKS_ALL_IP_RANGES\"\n}\n"}}}}]}, {"ruleId": "CKV_GCP_76", "ruleIndex": 19, "level": "error", "attachments": [], "message": {"text": "Ensure that Private google access is enabled for IPV6"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "network.tf"}, "region": {"startLine": 12, "endLine": 30, "snippet": {"text": "resource \"google_compute_subnetwork\" \"juniper_subnetwork\" {\n  name = \"juniper-cluster-subnetwork\"\n\n  ip_cidr_range = \"10.0.0.0/16\"\n  region        = var.region\n\n  stack_type       = \"IPV4_IPV6\"\n  ipv6_access_type = \"INTERNAL\"\n\n  private_ip_google_access = true\n\n  network = google_compute_network.juniper_network.id\n\n  log_config {\n    aggregation_interval = \"INTERVAL_10_MIN\"\n    flow_sampling        = 0.5\n    metadata             = \"INCLUDE_ALL_METADATA\"\n  }\n}\n"}}}}]}, {"ruleId": "CKV2_GCP_18", "ruleIndex": 20, "level": "error", "attachments": [], "message": {"text": "Ensure GCP network defines a firewall and does not use the default firewall"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "network.tf"}, "region": {"startLine": 1, "endLine": 10, "snippet": {"text": "resource \"google_compute_network\" \"juniper_network\" {\n  name = \"juniper-cluster-network\"\n\n  auto_create_subnetworks  = false\n  enable_ula_internal_ipv6 = true\n\n  depends_on = [\n    time_sleep.enable_all_services_with_timeout\n  ]\n}\n"}}}}]}, {"ruleId": "CKV2_GCP_13", "ruleIndex": 21, "level": "error", "attachments": [], "message": {"text": "Ensure PostgreSQL database flag 'log_duration' is set to 'on'"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "db.tf"}, "region": {"startLine": 2, "endLine": 30, "snippet": {"text": "resource \"google_sql_database_instance\" \"d2p\" {\n  name = \"d2p\"\n  database_version = \"POSTGRES_16\"\n  region           = var.region\n  deletion_protection = false\n  settings {\n    tier = var.db_tier\n    ip_configuration {\n      ipv4_enabled    = false\n      private_network = google_compute_network.juniper_network.self_link\n      enable_private_path_for_google_cloud_services = true\n    }\n\n    database_flags {\n      name  = \"cloudsql.iam_authentication\"\n      value = \"on\"\n    }\n\n    backup_configuration {\n      enabled = true\n      start_time = \"04:00\"\n    }\n  }\n\n  depends_on = [\n    time_sleep.enable_all_services_with_timeout,\n    google_service_networking_connection.private_vpc_connection\n  ]\n}\n"}}}}]}, {"ruleId": "CKV_K8S_21", "ruleIndex": 22, "level": "error", "attachments": [], "message": {"text": "The default namespace should not be used"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/participant-service.yml"}, "region": {"startLine": 1, "endLine": 12, "snippet": {"text": "apiVersion: v1\nkind: Service\nmetadata:\n  name: participant-service\nspec:\n  type: ClusterIP\n  selector:\n    app: participant\n  ports:\n    - protocol: TCP\n      port: 80\n      targetPort: 80\n"}}}}]}, {"ruleId": "CKV_K8S_21", "ruleIndex": 22, "level": "error", "attachments": [], "message": {"text": "The default namespace should not be used"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/b2c-config.yml"}, "region": {"startLine": 1, "endLine": 47, "snippet": {"text": "apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: portal-b2c-configmap\ndata:\n  portalB2CConfig.yaml: |\n    b2c:\n      atcp:\n        changePasswordPolicyName: does-not-exist\n        clientId: does-not-exist\n        policyName: does-not-exist\n        tenantName: does-not-exist\n      cmi:\n        changePasswordPolicyName: B2C_1A_ddp_participant_change_password_cmi-dev\n        clientId: 0cdfdafd-75fb-4e36-b6a2-c00e79c86bb0\n        policyName: B2C_1A_ddp_participant_signup_signin_cmi-dev\n        tenantName: junipercmidemo\n      demo:\n        changePasswordPolicyName: B2C_1A_ddp_participant_change_password_demo-dev\n        clientId: 37d95cc4-7c71-465e-9fc2-66be9a54c202\n        policyName: B2C_1A_ddp_participant_signup_signin_demo-dev\n        tenantName: juniperdemodev\n      gvasc:\n        changePasswordPolicyName: B2C_1A_ddp_participant_change_password_gvasc-dev\n        clientId: 441d57d2-5f17-473b-8b19-a2ed523c09bf\n        policyName: B2C_1A_ddp_participant_signup_signin_gvasc-dev\n        tenantName: gvascdev\n      hearthive:\n        changePasswordPolicyName: B2C_1A_ddp_participant_change_password_hearthive-dev\n        clientId: 8c778931-b7f6-4503-b30e-e975ab8ea615\n        policyName: B2C_1A_ddp_participant_signup_signin_hearthive-dev\n        tenantName: hearthivedev\n      ourhealth:\n        changePasswordPolicyName: B2C_1A_DDP_participant_change_password_ourhealth-dev\n        clientId: 206a23da-f303-4a9b-ad86-f51d1be51777\n        policyName: B2C_1A_DDP_participant_signup_signin_ourhealth-dev\n        tenantName: ourhealthdev\n      rgp:\n        changePasswordPolicyName: B2C_1A_ddp_participant_change_password_rgp-dev\n        clientId: 42445bb9-7ab2-48e9-b7a7-c5f84258e87b\n        policyName: B2C_1A_ddp_participant_signup_signin_rgp-dev\n        tenantName: juniperrgpdemo\n      template:\n        changePasswordPolicyName: does-not-exist\n        clientId: does-not-exist\n        policyName: does-not-exist\n        tenantName: does-not-exist\n"}}}}]}, {"ruleId": "CKV_K8S_21", "ruleIndex": 22, "level": "error", "attachments": [], "message": {"text": "The default namespace should not be used"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/ingress.yml"}, "region": {"startLine": 1, "endLine": 62, "snippet": {"text": "apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: juniper-ingress\n  annotations:\n    kubernetes.io/ingress.global-static-ip-name: admin-ip\n    networking.gke.io/managed-certificates: \"admin-cert,demo-cert\"\n    # If the class annotation is not specified it defaults to \"gce\".\n    kubernetes.io/ingress.class: \"gce\"\nspec:\n\n  rules:\n    # need:\n    # - sandbox.demo.juniper-cmi.dev\n    # - irb.demo.juniper-cmi.dev\n    # - demo.juniper-cmi.dev\n    # and for the other services (cmi, hearthive, atcp, ourhealth)\n    - host: \"sandbox.demo.juniper-cmi.dev\"\n      http:\n        paths:\n          - path: /*\n            pathType: ImplementationSpecific\n            backend:\n              service:\n                name: participant-service\n                port:\n                  number: 80\n    - host: \"irb.demo.juniper-cmi.dev\"\n      http:\n        paths:\n          - path: /*\n            pathType: ImplementationSpecific\n            backend:\n              service:\n                name: participant-service\n                port:\n                  number: 80\n    - host: \"demo.juniper-cmi.dev\"\n      http:\n        paths:\n          - path: /*\n            pathType: ImplementationSpecific\n            backend:\n              service:\n                name: participant-service\n                port:\n                  number: 80\n    - host: \"juniper-cmi.dev\"\n      http:\n        paths:\n          - path: /*\n            pathType: ImplementationSpecific\n            backend:\n              service:\n                name: admin-service\n                port:\n                  number: 80\n  defaultBackend:\n    service:\n      name: participant-service\n      port:\n        number: 80\n"}}}}]}, {"ruleId": "CKV_K8S_37", "ruleIndex": 23, "level": "error", "attachments": [], "message": {"text": "Minimize the admission of containers with capabilities assigned"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/admin-deployment.yml"}, "region": {"startLine": 1, "endLine": 207, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: admin-deployment\n  labels:\n    app: admin\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: admin\n  template:\n    metadata:\n      labels:\n        app: admin\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: admin\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-admin:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: B2C_CLIENT_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n            - name: B2C_POLICY_NAME\n              value: B2C_1A_ddp_admin_signup_signin_dev\n            - name: B2C_TENANT_NAME\n              value: ddpdevb2c\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_31", "ruleIndex": 24, "level": "error", "attachments": [], "message": {"text": "Ensure that the seccomp profile is set to docker/default or runtime/default"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/admin-deployment.yml"}, "region": {"startLine": 1, "endLine": 207, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: admin-deployment\n  labels:\n    app: admin\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: admin\n  template:\n    metadata:\n      labels:\n        app: admin\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: admin\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-admin:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: B2C_CLIENT_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n            - name: B2C_POLICY_NAME\n              value: B2C_1A_ddp_admin_signup_signin_dev\n            - name: B2C_TENANT_NAME\n              value: ddpdevb2c\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_8", "ruleIndex": 25, "level": "error", "attachments": [], "message": {"text": "Liveness Probe Should be Configured"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/admin-deployment.yml"}, "region": {"startLine": 1, "endLine": 207, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: admin-deployment\n  labels:\n    app: admin\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: admin\n  template:\n    metadata:\n      labels:\n        app: admin\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: admin\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-admin:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: B2C_CLIENT_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n            - name: B2C_POLICY_NAME\n              value: B2C_1A_ddp_admin_signup_signin_dev\n            - name: B2C_TENANT_NAME\n              value: ddpdevb2c\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_20", "ruleIndex": 26, "level": "error", "attachments": [], "message": {"text": "Containers should not run with allowPrivilegeEscalation"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/admin-deployment.yml"}, "region": {"startLine": 1, "endLine": 207, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: admin-deployment\n  labels:\n    app: admin\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: admin\n  template:\n    metadata:\n      labels:\n        app: admin\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: admin\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-admin:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: B2C_CLIENT_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n            - name: B2C_POLICY_NAME\n              value: B2C_1A_ddp_admin_signup_signin_dev\n            - name: B2C_TENANT_NAME\n              value: ddpdevb2c\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_15", "ruleIndex": 27, "level": "error", "attachments": [], "message": {"text": "Image Pull Policy should be Always"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/admin-deployment.yml"}, "region": {"startLine": 1, "endLine": 207, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: admin-deployment\n  labels:\n    app: admin\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: admin\n  template:\n    metadata:\n      labels:\n        app: admin\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: admin\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-admin:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: B2C_CLIENT_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n            - name: B2C_POLICY_NAME\n              value: B2C_1A_ddp_admin_signup_signin_dev\n            - name: B2C_TENANT_NAME\n              value: ddpdevb2c\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_13", "ruleIndex": 28, "level": "error", "attachments": [], "message": {"text": "Memory limits should be set"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/admin-deployment.yml"}, "region": {"startLine": 1, "endLine": 207, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: admin-deployment\n  labels:\n    app: admin\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: admin\n  template:\n    metadata:\n      labels:\n        app: admin\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: admin\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-admin:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: B2C_CLIENT_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n            - name: B2C_POLICY_NAME\n              value: B2C_1A_ddp_admin_signup_signin_dev\n            - name: B2C_TENANT_NAME\n              value: ddpdevb2c\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_40", "ruleIndex": 29, "level": "error", "attachments": [], "message": {"text": "Containers should run as a high UID to avoid host conflict"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/admin-deployment.yml"}, "region": {"startLine": 1, "endLine": 207, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: admin-deployment\n  labels:\n    app: admin\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: admin\n  template:\n    metadata:\n      labels:\n        app: admin\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: admin\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-admin:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: B2C_CLIENT_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n            - name: B2C_POLICY_NAME\n              value: B2C_1A_ddp_admin_signup_signin_dev\n            - name: B2C_TENANT_NAME\n              value: ddpdevb2c\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_22", "ruleIndex": 30, "level": "error", "attachments": [], "message": {"text": "Use read-only filesystem for containers where possible"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/admin-deployment.yml"}, "region": {"startLine": 1, "endLine": 207, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: admin-deployment\n  labels:\n    app: admin\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: admin\n  template:\n    metadata:\n      labels:\n        app: admin\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: admin\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-admin:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: B2C_CLIENT_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n            - name: B2C_POLICY_NAME\n              value: B2C_1A_ddp_admin_signup_signin_dev\n            - name: B2C_TENANT_NAME\n              value: ddpdevb2c\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_9", "ruleIndex": 31, "level": "error", "attachments": [], "message": {"text": "Readiness Probe Should be Configured"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/admin-deployment.yml"}, "region": {"startLine": 1, "endLine": 207, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: admin-deployment\n  labels:\n    app: admin\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: admin\n  template:\n    metadata:\n      labels:\n        app: admin\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: admin\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-admin:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: B2C_CLIENT_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n            - name: B2C_POLICY_NAME\n              value: B2C_1A_ddp_admin_signup_signin_dev\n            - name: B2C_TENANT_NAME\n              value: ddpdevb2c\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_28", "ruleIndex": 32, "level": "error", "attachments": [], "message": {"text": "Minimize the admission of containers with the NET_RAW capability"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/admin-deployment.yml"}, "region": {"startLine": 1, "endLine": 207, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: admin-deployment\n  labels:\n    app: admin\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: admin\n  template:\n    metadata:\n      labels:\n        app: admin\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: admin\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-admin:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: B2C_CLIENT_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n            - name: B2C_POLICY_NAME\n              value: B2C_1A_ddp_admin_signup_signin_dev\n            - name: B2C_TENANT_NAME\n              value: ddpdevb2c\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_29", "ruleIndex": 33, "level": "error", "attachments": [], "message": {"text": "Apply security context to your pods and containers"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/admin-deployment.yml"}, "region": {"startLine": 1, "endLine": 207, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: admin-deployment\n  labels:\n    app: admin\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: admin\n  template:\n    metadata:\n      labels:\n        app: admin\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: admin\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-admin:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: B2C_CLIENT_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n            - name: B2C_POLICY_NAME\n              value: B2C_1A_ddp_admin_signup_signin_dev\n            - name: B2C_TENANT_NAME\n              value: ddpdevb2c\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_30", "ruleIndex": 34, "level": "error", "attachments": [], "message": {"text": "Apply security context to your containers"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/admin-deployment.yml"}, "region": {"startLine": 1, "endLine": 207, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: admin-deployment\n  labels:\n    app: admin\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: admin\n  template:\n    metadata:\n      labels:\n        app: admin\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: admin\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-admin:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: B2C_CLIENT_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n            - name: B2C_POLICY_NAME\n              value: B2C_1A_ddp_admin_signup_signin_dev\n            - name: B2C_TENANT_NAME\n              value: ddpdevb2c\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_38", "ruleIndex": 35, "level": "error", "attachments": [], "message": {"text": "Ensure that Service Account Tokens are only mounted where necessary"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/admin-deployment.yml"}, "region": {"startLine": 1, "endLine": 207, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: admin-deployment\n  labels:\n    app: admin\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: admin\n  template:\n    metadata:\n      labels:\n        app: admin\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: admin\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-admin:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: B2C_CLIENT_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n            - name: B2C_POLICY_NAME\n              value: B2C_1A_ddp_admin_signup_signin_dev\n            - name: B2C_TENANT_NAME\n              value: ddpdevb2c\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_21", "ruleIndex": 22, "level": "error", "attachments": [], "message": {"text": "The default namespace should not be used"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/admin-deployment.yml"}, "region": {"startLine": 1, "endLine": 207, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: admin-deployment\n  labels:\n    app: admin\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: admin\n  template:\n    metadata:\n      labels:\n        app: admin\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: admin\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-admin:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: B2C_CLIENT_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n            - name: B2C_POLICY_NAME\n              value: B2C_1A_ddp_admin_signup_signin_dev\n            - name: B2C_TENANT_NAME\n              value: ddpdevb2c\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_23", "ruleIndex": 36, "level": "error", "attachments": [], "message": {"text": "Minimize the admission of root containers"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/admin-deployment.yml"}, "region": {"startLine": 1, "endLine": 207, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: admin-deployment\n  labels:\n    app: admin\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: admin\n  template:\n    metadata:\n      labels:\n        app: admin\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: admin\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-admin:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: B2C_CLIENT_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n            - name: B2C_POLICY_NAME\n              value: B2C_1A_ddp_admin_signup_signin_dev\n            - name: B2C_TENANT_NAME\n              value: ddpdevb2c\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_43", "ruleIndex": 37, "level": "error", "attachments": [], "message": {"text": "Image should use digest"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/admin-deployment.yml"}, "region": {"startLine": 1, "endLine": 207, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: admin-deployment\n  labels:\n    app: admin\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: admin\n  template:\n    metadata:\n      labels:\n        app: admin\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: admin\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-admin:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: B2C_CLIENT_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n            - name: B2C_POLICY_NAME\n              value: B2C_1A_ddp_admin_signup_signin_dev\n            - name: B2C_TENANT_NAME\n              value: ddpdevb2c\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_11", "ruleIndex": 38, "level": "error", "attachments": [], "message": {"text": "CPU limits should be set"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/admin-deployment.yml"}, "region": {"startLine": 1, "endLine": 207, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: admin-deployment\n  labels:\n    app: admin\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: admin\n  template:\n    metadata:\n      labels:\n        app: admin\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: admin\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-admin:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: B2C_CLIENT_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n            - name: B2C_POLICY_NAME\n              value: B2C_1A_ddp_admin_signup_signin_dev\n            - name: B2C_TENANT_NAME\n              value: ddpdevb2c\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_21", "ruleIndex": 22, "level": "error", "attachments": [], "message": {"text": "The default namespace should not be used"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/juniper-ksa-user.yml"}, "region": {"startLine": 1, "endLine": 6, "snippet": {"text": "apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: juniper-app-ksa\n  annotations:\n    iam.gke.io/gcp-service-account: juniper-app-gsa@broad-juniper-dev.iam.gserviceaccount.com\n"}}}}]}, {"ruleId": "CKV_K8S_21", "ruleIndex": 22, "level": "error", "attachments": [], "message": {"text": "The default namespace should not be used"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/site-config.yml"}, "region": {"startLine": 1, "endLine": 158, "snippet": {"text": "apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: d2p-site-configmap\ndata:\n  site.conf: >\n    ServerTokens ProductOnly\n\n    TraceEnable off\n\n    ServerSignature off\n\n\n    LogFormat \"%h %l %u \\\"%{OIDC_CLAIM_email}i\\\" \\\"%{X-App-ID}i\\\"\n    [%{%FT%T}t.%{msec_frac}t%{%z}t] %D %X \\\"%r\\\" %>s %b \\\"%{Referer}i\\\"\n    \\\"%{Origin}i\\\" \\\"%{User-Agent}i\\\"\" combined\n\n    LogFormat \"%{X-Forwarded-For}i %l %u \\\"%{OIDC_CLAIM_email}i\\\"\n    \\\"%{X-App-ID}i\\\" [%{%FT%T}t.%{msec_frac}t%{%z}t] %D %X \\\"%r\\\" %>s %b\n    \\\"%{Referer}i\\\" \\\"%{Origin}i\\\" \\\"%{User-Agent}i\\\"\" proxy\n\n    SetEnvIf X-Forwarded-For \"^.*\\..*\\..*\\..*\" forwarded\n\n    CustomLog \"/dev/stdout\" combined env=!forwarded\n\n    CustomLog \"/dev/stdout\" proxy env=forwarded\n\n\n    LogLevel info ssl:warn\n\n\n    Header unset X-Frame-Options\n\n    Header always set X-Frame-Options SAMEORIGIN\n\n    Header unset X-XSS-Protection\n\n    Header always set X-XSS-Protection \"1; mode=block\"\n\n    Header unset X-Content-Type-Options\n\n    Header always set X-Content-Type-Options: nosniff\n\n    Header unset Strict-Transport-Security\n\n    Header always set Strict-Transport-Security \"max-age=31536000;\n    includeSubDomains\"\n\n    Header unset Referrer-Policy\n\n    Header always set Referrer-Policy \"strict-origin-when-cross-origin\"\n\n\n    # Timeout only after 10 minutes 50 seconds\n\n    ProxyTimeout 650\n\n\n    <VirtualHost _default_:80>\n      RewriteEngine On\n      RewriteCond %{HTTP_HOST} ^www\\.(.*)$ [NC]\n      RewriteRule ^(.*)$ http://%1$1 [R=301,L]\n\n      DocumentRoot /app\n\n      <Directory \"/app\">\n        # disable mod_rewrite\n        RewriteEngine off\n\n        AllowOverride All\n        Options -Indexes\n\n        Order allow,deny\n        Allow from all\n      </Directory>\n\n      ErrorLog /dev/stdout\n      CustomLog \"/dev/stdout\" combined\n    \n      # routing rules for where to send traffic w/ no logged-in user\n    \n      # rfc7662 oauth2 introspection path\n      <Location /introspect/>\n        RewriteEngine off\n        Require all granted\n        AuthType None\n      </Location>\n    \n      # regex matcher for everything that isn't the oauth2 introspection path\n      <LocationMatch \"^(?!/introspect/)(/)(.*)\">\n    \n        RewriteCond %{REQUEST_METHOD} OPTIONS\n        RewriteRule ^(.*)$ $1 [R=204,L]\n    \n        <Limit OPTIONS>\n            Require all granted\n        </Limit>\n    \n        AuthType None\n        Require all granted\n    \n        ProxyPassMatch http://localhost:8080/$2\n        ProxyPassReverse http://localhost:8080/\n      </LocationMatch>\n    \n      # routing rules for where to send traffic for a logged-in user\n      <Location /api>\n        Header unset Access-Control-Allow-Origin\n        Header always set Access-Control-Allow-Origin \"*\"\n        Header unset Access-Control-Allow-Headers\n        Header always set Access-Control-Allow-Headers \"authorization,content-type,accept,origin,x-app-id\"\n        Header unset Access-Control-Allow-Methods\n        Header always set Access-Control-Allow-Methods \"GET,POST,PUT,PATCH,DELETE,OPTIONS,HEAD\"\n        Header unset Access-Control-Max-Age\n        Header always set Access-Control-Max-Age 1728000\n    \n        RewriteEngine On\n        RewriteCond %{REQUEST_METHOD} OPTIONS\n        RewriteRule ^(.*)$ $1 [R=204,L]\n    \n        <Limit OPTIONS>\n            Require all granted\n        </Limit>\n    \n        AuthType oauth2\n        <RequireAll>\n          # ID-444 Added this for security compliance\n          # Evaluates to true if the request contains email_verified=true, or if it is not present.\n          # Note: we need to reference %{REMOTE_USER} to ensure that this expression is evaluated _after_ the authentication has happened\n          # %{REMOTE_USER} != %{REMOTE_USER} will never evaluate to true but will ensure that the expression is evaluated at the correct time\n          Require expr \"%{REMOTE_USER} != %{REMOTE_USER} || %{HTTP:OAUTH2_CLAIM_email_verified} == 'true' || -z %{HTTP:OAUTH2_CLAIM_email_verified}\"\n          <RequireAll>\n            Require valid-user\n          </RequireAll>\n        </RequireAll>\n    \n        RequestHeader set oidc_claim_email \"expr=%{HTTP:OAUTH2_CLAIM_email}\"\n        RequestHeader set oidc_claim_user_id \"expr=%{HTTP:OAUTH2_CLAIM_sub}\"\n        RequestHeader set oidc_access_token \"expr=%{HTTP:OAUTH2_CLAIM_access_token}\"\n        RequestHeader set oidc_claim_expires_in \"expr=%{HTTP:OAUTH2_CLAIM_exp}\"\n    \n        ProxyPass http://localhost:8080/api\n        ProxyPassReverse http://localhost:8080/api\n    \n        AddOutputFilterByType DEFLATE application/json text/plain text/html application/javascript application/x-javascript\n      </Location>\n      # Begin additional unauthenticated routes\n      <Location /api/public>\n        RewriteEngine off\n        Require all granted\n        AuthType None\n    \n        ProxyPass http://localhost:8080/api/public\n        ProxyPassReverse http://localhost:8080/api/public\n      </Location>\n      # End additional routes\n\n    </VirtualHost>\n"}}}}]}, {"ruleId": "CKV_K8S_21", "ruleIndex": 22, "level": "error", "attachments": [], "message": {"text": "The default namespace should not be used"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/oauth2-config.yml"}, "region": {"startLine": 1, "endLine": 46, "snippet": {"text": "apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: d2p-oauth2-configmap\ndata:\n  oauth2.conf: >\n    OAuth2Cache shm max_val_size=16384\n\n    OAuth2TokenVerify metadata\n    https://ddpdevb2c.b2clogin.com/ddpdevb2c.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=b2c_1a_ddp_admin_signup_signin_dev\n    metadata.ssl_verify=true&verify.exp=required&verify.iat=skip\n\n    OAuth2TokenVerify metadata\n    https://ourhealthdev.b2clogin.com/ourhealthdev.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=b2c_1a_ddp_participant_signup_signin_ourhealth-dev\n    metadata.ssl_verify=true&verify.exp=required&verify.iat=skip\n\n    OAuth2TokenVerify metadata\n    https://hearthivedev.b2clogin.com/hearthivedev.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=b2c_1a_ddp_participant_signup_signin_hearthive-dev\n    metadata.ssl_verify=true&verify.exp=required&verify.iat=skip\n\n    OAuth2TokenVerify metadata\n    https://juniperdemodev.b2clogin.com/juniperdemodev.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=b2c_1a_ddp_participant_signup_signin_demo-dev\n    metadata.ssl_verify=true&verify.exp=required&verify.iat=skip\n\n    OAuth2TokenVerify metadata\n    https://gvascdev.b2clogin.com/gvascdev.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=b2c_1a_ddp_participant_signup_signin_gvasc-dev\n    metadata.ssl_verify=true&verify.exp=required&verify.iat=skip\n\n    OAuth2TokenVerify metadata\n    https://junipercmidemo.b2clogin.com/junipercmidemo.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=b2c_1a_ddp_participant_signup_signin_cmi-dev\n    metadata.ssl_verify=true&verify.exp=required&verify.iat=skip\n\n    OAuth2TokenVerify metadata\n    https://juniperrgpdemo.b2clogin.com/juniperrgpdemo.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=b2c_1a_ddp_participant_signup_signin_rgp-dev\n    metadata.ssl_verify=true&verify.exp=required&verify.iat=skip\n\n    OAuth2TokenVerify metadata\n    https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration\n    metadata.ssl_verify=true&verify.exp=required&verify.iat=skip\n\n    OAuth2TokenVerify metadata\n    https://accounts.google.com/.well-known/openid-configuration\n    metadata.ssl_verify=true&verify.exp=required&verify.iat=skip\n\n    OAuth2TokenVerify introspect https://127.0.0.1/introspect/\n    introspect.ssl_verify=false&verify.exp=required&verify.iat=skip\n"}}}}]}, {"ruleId": "CKV_K8S_21", "ruleIndex": 22, "level": "error", "attachments": [], "message": {"text": "The default namespace should not be used"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/admin-service.yml"}, "region": {"startLine": 1, "endLine": 12, "snippet": {"text": "apiVersion: v1\nkind: Service\nmetadata:\n  name: admin-service\nspec:\n  type: ClusterIP\n  selector:\n    app: admin\n  ports:\n    - protocol: TCP\n      port: 80\n      targetPort: 80\n"}}}}]}, {"ruleId": "CKV_K8S_37", "ruleIndex": 23, "level": "error", "attachments": [], "message": {"text": "Minimize the admission of containers with capabilities assigned"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/participant-deployment.yml"}, "region": {"startLine": 1, "endLine": 199, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: participant-deployment\n  labels:\n    app: participant\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: participant\n  template:\n    metadata:\n      labels:\n        app: participant\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: participant\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-participant:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: B2C_CONFIG_FILE\n              value: /etc/app/portalB2CConfig.yaml\n            - name: SERVER_PORT\n              value: '8080'\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              memory: \"2Gi\"\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_31", "ruleIndex": 24, "level": "error", "attachments": [], "message": {"text": "Ensure that the seccomp profile is set to docker/default or runtime/default"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/participant-deployment.yml"}, "region": {"startLine": 1, "endLine": 199, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: participant-deployment\n  labels:\n    app: participant\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: participant\n  template:\n    metadata:\n      labels:\n        app: participant\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: participant\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-participant:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: B2C_CONFIG_FILE\n              value: /etc/app/portalB2CConfig.yaml\n            - name: SERVER_PORT\n              value: '8080'\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              memory: \"2Gi\"\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_8", "ruleIndex": 25, "level": "error", "attachments": [], "message": {"text": "Liveness Probe Should be Configured"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/participant-deployment.yml"}, "region": {"startLine": 1, "endLine": 199, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: participant-deployment\n  labels:\n    app: participant\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: participant\n  template:\n    metadata:\n      labels:\n        app: participant\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: participant\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-participant:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: B2C_CONFIG_FILE\n              value: /etc/app/portalB2CConfig.yaml\n            - name: SERVER_PORT\n              value: '8080'\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              memory: \"2Gi\"\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_20", "ruleIndex": 26, "level": "error", "attachments": [], "message": {"text": "Containers should not run with allowPrivilegeEscalation"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/participant-deployment.yml"}, "region": {"startLine": 1, "endLine": 199, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: participant-deployment\n  labels:\n    app: participant\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: participant\n  template:\n    metadata:\n      labels:\n        app: participant\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: participant\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-participant:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: B2C_CONFIG_FILE\n              value: /etc/app/portalB2CConfig.yaml\n            - name: SERVER_PORT\n              value: '8080'\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              memory: \"2Gi\"\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_15", "ruleIndex": 27, "level": "error", "attachments": [], "message": {"text": "Image Pull Policy should be Always"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/participant-deployment.yml"}, "region": {"startLine": 1, "endLine": 199, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: participant-deployment\n  labels:\n    app: participant\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: participant\n  template:\n    metadata:\n      labels:\n        app: participant\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: participant\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-participant:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: B2C_CONFIG_FILE\n              value: /etc/app/portalB2CConfig.yaml\n            - name: SERVER_PORT\n              value: '8080'\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              memory: \"2Gi\"\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_13", "ruleIndex": 28, "level": "error", "attachments": [], "message": {"text": "Memory limits should be set"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/participant-deployment.yml"}, "region": {"startLine": 1, "endLine": 199, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: participant-deployment\n  labels:\n    app: participant\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: participant\n  template:\n    metadata:\n      labels:\n        app: participant\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: participant\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-participant:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: B2C_CONFIG_FILE\n              value: /etc/app/portalB2CConfig.yaml\n            - name: SERVER_PORT\n              value: '8080'\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              memory: \"2Gi\"\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_40", "ruleIndex": 29, "level": "error", "attachments": [], "message": {"text": "Containers should run as a high UID to avoid host conflict"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/participant-deployment.yml"}, "region": {"startLine": 1, "endLine": 199, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: participant-deployment\n  labels:\n    app: participant\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: participant\n  template:\n    metadata:\n      labels:\n        app: participant\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: participant\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-participant:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: B2C_CONFIG_FILE\n              value: /etc/app/portalB2CConfig.yaml\n            - name: SERVER_PORT\n              value: '8080'\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              memory: \"2Gi\"\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_22", "ruleIndex": 30, "level": "error", "attachments": [], "message": {"text": "Use read-only filesystem for containers where possible"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/participant-deployment.yml"}, "region": {"startLine": 1, "endLine": 199, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: participant-deployment\n  labels:\n    app: participant\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: participant\n  template:\n    metadata:\n      labels:\n        app: participant\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: participant\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-participant:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: B2C_CONFIG_FILE\n              value: /etc/app/portalB2CConfig.yaml\n            - name: SERVER_PORT\n              value: '8080'\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              memory: \"2Gi\"\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_9", "ruleIndex": 31, "level": "error", "attachments": [], "message": {"text": "Readiness Probe Should be Configured"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/participant-deployment.yml"}, "region": {"startLine": 1, "endLine": 199, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: participant-deployment\n  labels:\n    app: participant\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: participant\n  template:\n    metadata:\n      labels:\n        app: participant\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: participant\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-participant:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: B2C_CONFIG_FILE\n              value: /etc/app/portalB2CConfig.yaml\n            - name: SERVER_PORT\n              value: '8080'\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              memory: \"2Gi\"\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_28", "ruleIndex": 32, "level": "error", "attachments": [], "message": {"text": "Minimize the admission of containers with the NET_RAW capability"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/participant-deployment.yml"}, "region": {"startLine": 1, "endLine": 199, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: participant-deployment\n  labels:\n    app: participant\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: participant\n  template:\n    metadata:\n      labels:\n        app: participant\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: participant\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-participant:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: B2C_CONFIG_FILE\n              value: /etc/app/portalB2CConfig.yaml\n            - name: SERVER_PORT\n              value: '8080'\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              memory: \"2Gi\"\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_29", "ruleIndex": 33, "level": "error", "attachments": [], "message": {"text": "Apply security context to your pods and containers"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/participant-deployment.yml"}, "region": {"startLine": 1, "endLine": 199, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: participant-deployment\n  labels:\n    app: participant\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: participant\n  template:\n    metadata:\n      labels:\n        app: participant\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: participant\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-participant:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: B2C_CONFIG_FILE\n              value: /etc/app/portalB2CConfig.yaml\n            - name: SERVER_PORT\n              value: '8080'\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              memory: \"2Gi\"\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_30", "ruleIndex": 34, "level": "error", "attachments": [], "message": {"text": "Apply security context to your containers"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/participant-deployment.yml"}, "region": {"startLine": 1, "endLine": 199, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: participant-deployment\n  labels:\n    app: participant\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: participant\n  template:\n    metadata:\n      labels:\n        app: participant\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: participant\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-participant:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: B2C_CONFIG_FILE\n              value: /etc/app/portalB2CConfig.yaml\n            - name: SERVER_PORT\n              value: '8080'\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              memory: \"2Gi\"\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_38", "ruleIndex": 35, "level": "error", "attachments": [], "message": {"text": "Ensure that Service Account Tokens are only mounted where necessary"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/participant-deployment.yml"}, "region": {"startLine": 1, "endLine": 199, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: participant-deployment\n  labels:\n    app: participant\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: participant\n  template:\n    metadata:\n      labels:\n        app: participant\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: participant\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-participant:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: B2C_CONFIG_FILE\n              value: /etc/app/portalB2CConfig.yaml\n            - name: SERVER_PORT\n              value: '8080'\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              memory: \"2Gi\"\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_21", "ruleIndex": 22, "level": "error", "attachments": [], "message": {"text": "The default namespace should not be used"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/participant-deployment.yml"}, "region": {"startLine": 1, "endLine": 199, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: participant-deployment\n  labels:\n    app: participant\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: participant\n  template:\n    metadata:\n      labels:\n        app: participant\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: participant\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-participant:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: B2C_CONFIG_FILE\n              value: /etc/app/portalB2CConfig.yaml\n            - name: SERVER_PORT\n              value: '8080'\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              memory: \"2Gi\"\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_23", "ruleIndex": 36, "level": "error", "attachments": [], "message": {"text": "Minimize the admission of root containers"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/participant-deployment.yml"}, "region": {"startLine": 1, "endLine": 199, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: participant-deployment\n  labels:\n    app: participant\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: participant\n  template:\n    metadata:\n      labels:\n        app: participant\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: participant\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-participant:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: B2C_CONFIG_FILE\n              value: /etc/app/portalB2CConfig.yaml\n            - name: SERVER_PORT\n              value: '8080'\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              memory: \"2Gi\"\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_43", "ruleIndex": 37, "level": "error", "attachments": [], "message": {"text": "Image should use digest"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/participant-deployment.yml"}, "region": {"startLine": 1, "endLine": 199, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: participant-deployment\n  labels:\n    app: participant\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: participant\n  template:\n    metadata:\n      labels:\n        app: participant\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: participant\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-participant:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: B2C_CONFIG_FILE\n              value: /etc/app/portalB2CConfig.yaml\n            - name: SERVER_PORT\n              value: '8080'\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              memory: \"2Gi\"\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV_K8S_11", "ruleIndex": 38, "level": "error", "attachments": [], "message": {"text": "CPU limits should be set"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/participant-deployment.yml"}, "region": {"startLine": 1, "endLine": 199, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: participant-deployment\n  labels:\n    app: participant\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: participant\n  template:\n    metadata:\n      labels:\n        app: participant\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: participant\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-participant:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: B2C_CONFIG_FILE\n              value: /etc/app/portalB2CConfig.yaml\n            - name: SERVER_PORT\n              value: '8080'\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              memory: \"2Gi\"\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV2_K8S_6", "ruleIndex": 39, "level": "error", "attachments": [], "message": {"text": "Minimize the admission of pods which lack an associated NetworkPolicy"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/admin-deployment.yml"}, "region": {"startLine": 1, "endLine": 207, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: admin-deployment\n  labels:\n    app: admin\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: admin\n  template:\n    metadata:\n      labels:\n        app: admin\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: admin\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-admin:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: B2C_CLIENT_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n            - name: B2C_POLICY_NAME\n              value: B2C_1A_ddp_admin_signup_signin_dev\n            - name: B2C_TENANT_NAME\n              value: ddpdevb2c\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}, {"ruleId": "CKV2_K8S_6", "ruleIndex": 39, "level": "error", "attachments": [], "message": {"text": "Minimize the admission of pods which lack an associated NetworkPolicy"}, "locations": [{"physicalLocation": {"artifactLocation": {"uri": "k8s/participant-deployment.yml"}, "region": {"startLine": 1, "endLine": 199, "snippet": {"text": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: participant-deployment\n  labels:\n    app: participant\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: participant\n  template:\n    metadata:\n      labels:\n        app: participant\n    spec:\n      serviceAccountName: juniper-app-ksa\n      containers:\n        - name: cloud-sql-proxy\n          # It is recommended to use the latest version of the Cloud SQL Auth Proxy\n          # Make sure to update on a regular schedule!\n          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.11.4\n          args:\n            # If connecting from a VPC-native GKE cluster, you can use the\n            # following flag to have the proxy connect over private IP\n            - \"--private-ip\"\n\n            # Enable structured logging with LogEntry format:\n            - \"--structured-logs\"\n\n            # Replace DB_PORT with the port the proxy should listen on\n            - \"--port=5432\"\n            - \"broad-juniper-dev:us-central1:d2p\"\n\n          securityContext:\n            # The default Cloud SQL Auth Proxy image runs as the\n            # \"nonroot\" user and group (uid: 65532) by default.\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          # You should use resource requests/limits as a best practice to prevent\n          # pods from consuming too many resources and affecting the execution of\n          # other pods. You should adjust the following values based on what your\n          # application needs. For details, see\n          # https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n          resources:\n            requests:\n              # The proxy's memory use scales linearly with the number of active\n              # connections. Fewer open connections will use less memory. Adjust\n              # this value based on your application's requirements.\n              memory: \"2Gi\"\n              # The proxy's CPU use scales linearly with the amount of IO between\n              # the database and the application. Adjust this value based on your\n              # application's requirements.\n              cpu: \"1\"\n\n        - name: participant\n          imagePullPolicy: Always\n          image: us-central1-docker.pkg.dev/broad-juniper-eng-infra/juniper/juniper-participant:1.3.96\n          livenessProbe:\n            failureThreshold: 30\n            httpGet:\n              path: /version\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /status\n              port: 8080\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          securityContext:\n            runAsNonRoot: true\n            allowPrivilegeEscalation: false\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: gcp\n            - name: DB_NAME_SECRET_ID\n              value: \"d2p-db-name\"\n            - name: DB_PASSWORD_SECRET_ID\n              value: \"d2p-db-password\"\n            - name: DB_USER_SECRET_ID\n              value: \"d2p-db-user\"\n            - name: GCP_PROJECT_ID\n              value: \"broad-juniper-dev\"\n            - name: DATABASE_NAME\n              value: \"d2p\"\n            - name: DEPLOYMENT_ZONE\n              value: dev\n            - name: ADMIN_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: ADMIN_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_API_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: PARTICIPANT_UI_HOSTNAME\n              value: \"juniper-cmi.dev\"\n            - name: TDR_ADDRESS\n              value: https://jade.datarepo-dev.broadinstitute.org\n            - name: B2C_CONFIG_FILE\n              value: /etc/app/portalB2CConfig.yaml\n            - name: SERVER_PORT\n              value: '8080'\n            - name: TDR_EXPORT_ENABLED\n              value: 'true'\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_NAME\n              value: juniperdevtdr\n            - name: TDR_EXPORT_STORAGE_CONTAINER_NAME\n              value: juniper-dataset-ingest\n            - name: ADDRESS_VALIDATION_SERVICE_CLASS\n              value: SmartyUSAddressValidationService\n            - name: SMARTY_AUTH_ID_SECRET_ID\n              value: smarty-auth-id\n            - name: SMARTY_AUTH_TOKEN_SECRET_ID\n              value: smarty-auth-token\n            - name: SENDGRID_API_KEY_SECRET_ID\n              value: sendgrid-api-key\n            - name: DSM_JWT_ISSUER\n              value: admin-d2p.ddp-dev.envs.broadinstitute.org\n            - name: DSM_JWT_SIGNING_SECRET_SECRET_ID\n              value: dsm-secret\n            - name: DSM_ADDRESS\n              value: https://dsm-dev.datadonationplatform.org/dsm\n            - name: TDR_SA_CREDS_SECRET_ID\n              value: tdr-sa-creds\n            - name: TDR_EXPORT_STORAGE_ACCOUNT_KEY_SECRET_ID\n              value: tdr-storage-account-key\n          resources:\n            requests:\n              memory: \"2Gi\"\n              cpu: \"500m\"\n          volumeMounts:\n            - mountPath: /etc/app/portalB2CConfig.yaml\n              name: portal-b2c-configmap-mount\n              readOnly: true\n              subPath: portalB2CConfig.yaml\n        - image: us.gcr.io/broad-dsp-gcr-public/httpd-terra-proxy:v0.1.18\n          imagePullPolicy: IfNotPresent\n          name: oidc-proxy\n          ports:\n            - containerPort: 80\n              protocol: TCP\n          env:\n            - name: REMOTE_USER_CLAIM\n              value: sub\n            - name: B2C_APPLICATION_ID\n              value: 705c09dc-5cca-43d3-ae06-07de78bad29a\n          volumeMounts:\n            - mountPath: /etc/httpd/conf.d/site.conf\n              name: d2p-site-configmap-mount\n              readOnly: true\n              subPath: site.conf\n            - mountPath: /etc/httpd/conf.d/oauth2.conf\n              name: d2p-oauth2-configmap-mount\n              readOnly: true\n              subPath: oauth2.conf\n          readinessProbe:\n            failureThreshold: 6\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            initialDelaySeconds: 20\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          startupProbe:\n            failureThreshold: 1110\n            httpGet:\n              path: /version\n              port: 80\n              scheme: HTTP\n            periodSeconds: 10\n            successThreshold: 1\n            timeoutSeconds: 5\n          resources:\n            requests:\n              memory: \"1Gi\"\n              cpu: \"500m\"\n      volumes:\n        - configMap:\n            defaultMode: 420\n            name: d2p-oauth2-configmap\n          name: d2p-oauth2-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: d2p-site-configmap\n          name: d2p-site-configmap-mount\n        - configMap:\n            defaultMode: 420\n            name: portal-b2c-configmap\n          name: portal-b2c-configmap-mount\n"}}}}]}]}]}